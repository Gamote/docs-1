---
title: 'Referential integrity'
metaTitle: 'Referential integrity'
metaDescription: 'Referential integrity lets you define how the consistency of relations is handled.'
tocDepth: 2
preview: true
---

<TopBlock>

To keep data consistent, it is necessary to have rules for what happens when related records are deleted or updated. For example, a blog post data model will need to define what happens to a post if its author is deleted. **Referential integrity** refers to the set of constraints or triggers used to enforce this consistency.

In Prisma, relations between records are defined using the [`@relation`](/reference/api-reference/prisma-schema-reference#relation) attribute. The `onUpdate` and `onDelete` arguments of this attribute can be used to define which **referential actions** take place on updating or deleting the related record.

For example, take the following blog post schema, with a one-to-many relation between `User`s and `Post`s:

```prisma file=schema.prisma highlight=4;normal
model Post {
  id       Int    @id @default(autoincrement())
  title    String
  author   User   @relation(fields: [authorId], references: [id], onDelete: Cascade)
  authorId Int
}

model User {
  id    Int    @id @default(autoincrement())
  posts Post[]
}
```

In this case, the `onDelete: Cascade` argument specifies the `Cascade` action, deleting the post if the related user is deleted. See [Referential actions](/concepts/components/prisma-schema/relations/referential-actions) for further details of supported actions.

When connecting to relational databases that support foreign keys, referential integrity can be handled in the underlying database. This is the default option in Prisma when using SQL databases.

Alternatively, Prisma can emulate referential integrity in the client. This is the default option for MongoDB, which does not support foreign keys, and can also be selected for relational databases in cases where foreign keys are not supported, or not preferred due to scaling reasons.

<Admonition type="warning">
  There are significant performance implications to emulating referential
  integrity in the Prisma client. In cases where the underlying database can
  handle referential integrity with foreign keys, it is usually the preferred
  choice.
</Admonition>

</TopBlock>

## Setting the referential integrity in the datasource

Referential integrity is currently a Preview feature. To enable this, add it to the `previewFeatures` list in the `generator` block of `schema.prisma`:

```prisma file=schema.prisma
datasource db {
  provider             = "mysql"
  url                  = env("DATABASE_URL")
  referentialIntegrity = "prisma"
}

generator js {
  provider        = "prisma-client-js"
  previewFeatures = ["referentialIntegrity"]
}
```

To change the type of referential integrity supported, update the `referentialIntegrity` paramater in the [`datasource`](/reference/api-reference/prisma-schema-reference#datasource) block. The available options are:

- `foreignKeys`: this handles referential integrity in the database using foreign keys. This is the default option when using all SQL database connectors.
- `prisma`: this emulates referential integrity in the Prisma client. This is the default (and only available) option when using the MongoDB connector.

<Admonition type="warning">
  Setting the value to `prisma` will remove all previously created foreign keys
  in the next migration when using Prisma Migrate. Setting the value to
  `foreignKeys` will create foreign keys for all relations in the next migration
  when using Prisma Migrate.
</Admonition>

## Handling the referential integrity in Prisma

If referential integrity is handled by the Prisma Client, there is currently a reduced number of supported [referential actions](/concepts/components/prisma-schema/relations/referential-actions) available in the data model:

| Referential action | `onUpdate` | `onDelete` |
| :----------------- | :--------- | :--------- |
| Restrict           | yes        | yes        |
| SetNull            | yes        | yes        |
| SetDefault         | no         | no         |
| Cascade            | yes        | yes        |
| NoAction           | yes        | yes        |

In this mode, any [`raw`](https://www.prisma.io/docs/concepts/components/prisma-client/raw-database-access) database queries will not trigger any of the actions, and they should be handled manually if deleting or updating records using the [`raw`](https://www.prisma.io/docs/concepts/components/prisma-client/raw-database-access) queries.

The relations are needed for the client to be able to join data between models, so when using the `db pull` command to a database with `referentialIntegrity` set to `prisma` in the `datasource`, existing relations are kept in the data model. This has some caveats:

- When a model in the database is deleted, the relation on the other side gets deleted, if existing.
- When a scalar field used in a relation field gets deleted or renamed, the relation field is kept as-is, leading to validation errors. The user must fix the relation before continuing to use the data model in this case.

## Handling the referential integrity with foreign keys

Having the referential integrity handled in the database, all referential actions supported by the database are available:

| action      | `onUpdate` | `onDelete` |
| :---------- | :--------- | :--------- |
| Restrict⟒   | yes        | yes        |
| SetNull     | yes        | yes        |
| SetDefault⟑ | yes        | yes        |
| Cascade     | yes        | yes        |
| NoAction    | yes        | yes        |

- ⟒ Not supported on SQL Server
- ⟑ Not supported on MySQL/InnoDB

In this mode the [`raw`](https://www.prisma.io/docs/concepts/components/prisma-client/raw-database-access) database queries will trigger actions accordingly.
